# Generative Model Transaction Feature Schema (Based on THORChain Midgard API v2)

This document outlines the comprehensive feature schema for transactions from the THORChain Midgard API (v2 `/actions` endpoint). This schema will serve as the basis for the generative transaction prediction model.

**V1 Simplifications:**
*   For `in` and `out` arrays (which can contain multiple transaction objects), only the **first** transaction object in each array will be processed.
*   For `coins` arrays within an `in` or `out` transaction object, only the **first** coin will be processed.
*   Direct prediction of full `txID` strings is deferred; presence/absence or simplified categorical representations will be used initially.
*   `memo` fields are treated as categorical (presence/absence/emptiness) rather than full text features for V1.

## Schema Table

| Feature Name                      | Raw Data Type (API)         | Modeling Type   | Cardinality (Est.) | Variability                                  | Preprocessing Strategy                                                                                                                               | Notes/Rationale                                                                                                                               |
|-----------------------------------|-----------------------------|-----------------|--------------------|----------------------------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------|
| **Global Action Features**        |                             |                 |                    |                                              |                                                                                                                                                      |                                                                                                                                               |
| `action_date`                     | string (ns timestamp)       | Numerical       | N/A                | Always                                       | Convert to Unix seconds (float), Scale (e.g., `StandardScaler`)                                                                                      | Primary timestamp of the action.                                                                                                              |
| `action_height`                   | string (block height)       | Numerical       | N/A                | Always                                       | Convert to integer, Scale.                                                                                                                           | Blockchain height at which the action occurred.                                                                                               |
| `action_status`                   | string                      | Categorical     | Low (e.g., 2-5)    | Always                                       | ID Map (e.g., `status_to_id.json`), UNK/PAD IDs.                                                                                                     | e.g., "success", "pending", "failed" (if applicable).                                                                                         |
| `action_type`                     | string                      | Categorical     | Mid (e.g., 5-15)   | Always                                       | ID Map (e.g., `type_to_id.json`), UNK/PAD IDs.                                                                                                       | e.g., "swap", "addLiquidity", "withdraw", "refund", "donate", "switch", "thorname", etc.                                                      |
| `action_pools`                    | array of strings (assets)   | Categorical     | Mid (per pool)     | Variable (swaps, LP actions)                 | Predict `pool1_id`, `pool2_id`. Map assets to IDs using `asset_to_id.json` (e.g., `ETH~ETH`). Use `PAD_ASSET_ID` if <2 pools. Truncate if >2 pools.                 | Pools involved in the action. For V1, handle up to 2.                                                                                         |
| **Inbound Transaction Features (First `in` entry)** |                             |                 |                    |                                              |                                                                                                                                                      | Features from the first object in the `in` array.                                                                                             |
| `in_tx_id_present`                | (derived)                   | Binary Flag     | 2                  | Always (derived)                             | 0 if no `in` array or no `txID` in first `in` item, 1 otherwise.                                                                                     | Indicates presence of an inbound transaction ID.                                                                                              |
| `in_address_present`              | (derived)                   | Binary Flag     | 2                  | Always (derived)                             | 0 if no `in_address`, 1 otherwise.                                                                                                                   |                                                                                                                                               |
| `in_address_hash`                 | string                      | Categorical     | Very High          | If `in_address_present`                      | Feature Hashing (e.g., 20k vocab) if present, else special `PAD_HASH_ID`.                                                                              | Sender's address.                                                                                                                             |
| `in_memo_status`                  | string (memo content)       | Categorical     | Low (3: none, empty, non-empty) | Always (derived)                             | Map to ID: `NO_MEMO`, `EMPTY_MEMO`, `NON_EMPTY_MEMO`.                                                                                                | Status of the memo in the first `in` transaction.                                                                                             |
| `in_coin1_asset_id`               | string (asset)              | Categorical     | Mid                | If coin present                              | ID Map (`asset_to_id.json` - e.g., `ETH~ETH`, `AVAX~USDC-0X...`), `PAD_ASSET_ID` if no coin.                                                                                              | Asset of the first coin in the first `in` transaction.                                                                                        |
| `in_coin1_amount`                 | string (integer amount)     | Numerical       | N/A                | If coin present                              | Convert to float (adjust for 1e8), Scale. Use 0 or special PAD value if no coin.                                                                       | Amount of the first coin.                                                                                                                     |
| `in_coin1_affiliate_present`      | boolean (`affiliate` field in `in[0].coins[0]` from some API versions, or derived from `metadata.swap.affiliateAddress` for swaps) | Binary Flag     | 2                  | Variable (depends on API & action type)      | 0 if no affiliate data associated with this input, 1 otherwise.                                                                              | Indicates if this specific input coin is associated with an affiliate. Check API for exact location. Often linked to metadata.              |
| **Outbound Transaction Features (First `out` entry)** |                             |                 |                    |                                              |                                                                                                                                                      | Features from the first object in the `out` array.                                                                                            |
| `out_tx_id_present`               | (derived)                   | Binary Flag     | 2                  | Always (derived)                             | 0 if no `out` array or no `txID` in first `out` item, 1 otherwise.                                                                                   | Indicates presence of an outbound transaction ID.                                                                                             |
| `out_address_present`             | (derived)                   | Binary Flag     | 2                  | Always (derived)                             | 0 if no `out_address`, 1 otherwise.                                                                                                                  |                                                                                                                                               |
| `out_address_hash`                | string                      | Categorical     | Very High          | If `out_address_present`                     | Feature Hashing (e.g., 20k vocab) if present, else special `PAD_HASH_ID`.                                                                              | Recipient's address.                                                                                                                          |
| `out_coin1_asset_id`              | string (asset)              | Categorical     | Mid                | If coin present in `out`                     | ID Map (`asset_to_id.json` - e.g., `THOR.RUNE`), `PAD_ASSET_ID` if no coin.                                                                                              | Asset of the first coin in the first `out` transaction.                                                                                       |
| `out_coin1_amount`                | string (integer amount)     | Numerical       | N/A                | If coin present in `out`                     | Convert to float (adjust for 1e8), Scale. Use 0 or special PAD value if no coin.                                                                       | Amount of the first coin.                                                                                                                     |
| **Metadata Features (Flattened)** |                             |                 |                    |                                              | All metadata fields are prefixed with `meta_`. Assume 0/NaN/PAD if not applicable to `action_type`. Binary flags indicate `action_type`.           |                                                                                                                                               |
| `meta_is_swap`                    | (derived from `action_type`)| Binary Flag     | 2                  | Always (derived)                             | 1 if `action_type` is "swap", 0 otherwise.                                                                                                           | Helps condition the prediction of swap-specific metadata.                                                                                     |
| `meta_swap_liquidityFee`          | string (integer)            | Numerical       | N/A                | If `meta_is_swap`                            | Convert to float (1e8), Scale. Use 0/PAD if not swap.                                                                                                | Liquidity fee for the swap.                                                                                                                   |
| `meta_swap_swapSlip_bps`          | string (integer, bps)       | Numerical       | N/A                | If `meta_is_swap`                            | Convert to int, Scale. Use 0/PAD if not swap.                                                                                                        | Swap slip in basis points.                                                                                                                    |
| `meta_swap_networkFee1_asset_id`  | string (asset)              | Categorical     | Mid                | If `meta_is_swap` and fee present            | ID Map (`asset_to_id.json` - e.g., `THOR.RUNE`), `PAD_ASSET_ID` if not applicable/present.                                                                               | Asset of the first network fee for the swap's outbound leg.                                                                                   |
| `meta_swap_networkFee1_amount`    | string (integer)            | Numerical       | N/A                | If `meta_is_swap` and fee present            | Convert to float (1e8), Scale. Use 0/PAD if not applicable/present.                                                                                  | Amount of the first network fee.                                                                                                              |
| `meta_swap_target_asset_id`       | string (asset)              | Categorical     | Mid                | If `meta_is_swap`                            | ID Map (`asset_to_id.json` - e.g., `THOR.RUNE`), `PAD_ASSET_ID` if not swap.                                                                                             | Intended target asset of the swap (often same as `out_coin1_asset_id`).                                                                     |
| `meta_swap_affiliate_address_present` | (derived)                   | Binary Flag     | 2                  | Always (derived)                             | 1 if `metadata.swap.affiliateAddress` is present and non-empty, 0 otherwise.                                                                         |                                                                                                                                               |
| `meta_swap_affiliate_address_hash`| string                      | Categorical     | High               | If `meta_swap_affiliate_address_present`     | Feature Hashing (e.g., 5k vocab) if present, else `PAD_HASH_ID`.                                                                                       | Affiliate address for the swap.                                                                                                               |
| `meta_swap_affiliateFee_amount`   | string (integer)            | Numerical       | N/A                | If `meta_swap_affiliate_address_present`     | Convert to float (1e8), Scale. Use 0/PAD if no affiliate.                                                                                            | Affiliate fee amount.                                                                                                                         |
| `meta_swap_memo`                  | string                      | Categorical     | Low (3: none, empty, non-empty) | Always (derived from `metadata.swap.memo`)   | Map to ID: `NO_MEMO`, `EMPTY_MEMO`, `NON_EMPTY_MEMO`.                                                                                                | Specific memo for the swap metadata.                                                                                                          |
| `meta_swap_is_streaming`          | boolean (`isStreamingSwap`) | Binary Flag     | 2                  | If `meta_is_swap`                            | 0 or 1. Use 0 if not present or not swap.                                                                                                            | Indicates if it's a streaming swap.                                                                                                           |
| `meta_swap_streaming_count`       | string (integer)            | Numerical       | N/A                | If `meta_swap_is_streaming`                  | Convert to int, Scale. Use 0/PAD if not streaming.                                                                                                   | Number of intervals in a streaming swap.                                                                                                      |
| `meta_swap_streaming_quantity`    | string (integer)            | Numerical       | N/A                | If `meta_swap_is_streaming`                  | Convert to float (1e8), Scale. Use 0/PAD if not streaming.                                                                                           | Total quantity per streaming swap interval.                                                                                                   |
| `meta_is_addLiquidity`            | (derived from `action_type`)| Binary Flag     | 2                  | Always (derived)                             | 1 if `action_type` is "addLiquidity", 0 otherwise.                                                                                                   |                                                                                                                                               |
| `meta_addLiquidity_units`         | string (integer)            | Numerical       | N/A                | If `meta_is_addLiquidity`                    | Convert to float, Scale. Use 0/PAD if not addLiquidity.                                                                                              | Liquidity units minted.                                                                                                                       |
| `meta_is_withdraw`                | (derived from `action_type`)| Binary Flag     | 2                  | Always (derived)                             | 1 if `action_type` is "withdraw" (or "withdrawLiquidity"), 0 otherwise.                                                                              |                                                                                                                                               |
| `meta_withdraw_units`             | string (integer)            | Numerical       | N/A                | If `meta_is_withdraw`                        | Convert to float, Scale. Use 0/PAD if not withdraw.                                                                                                  | Liquidity units burned.                                                                                                                       |
| `meta_withdraw_basis_points`      | string (integer, bps)       | Numerical       | N/A                | If `meta_is_withdraw`                        | Convert to int, Scale. Use 0/PAD if not withdraw.                                                                                                    | Percentage of liquidity withdrawn (10000 bps = 100%).                                                                                         |
| `meta_withdraw_asymmetry`         | string (float)              | Numerical       | N/A                | If `meta_is_withdraw`                        | Convert to float, Scale. Use 0/PAD if not withdraw or not asymmetric.                                                                                | Asymmetry of withdrawal.                                                                                                                      |
| `meta_withdraw_imp_loss_protection`| string (integer)            | Numerical       | N/A                | If `meta_is_withdraw`                        | Convert to float (1e8), Scale. Use 0/PAD if not applicable.                                                                                          | Impermanent loss protection amount provided.                                                                                                  |
| `meta_is_refund`                  | (derived from `action_type`